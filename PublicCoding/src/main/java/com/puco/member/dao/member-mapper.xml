<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.puco.member.dao.member-mapper">
	<sql id="midcheck">
		WHERE mid=#{id}
	</sql>
	<!-- ID check -->
	<select id="memberIdCount" resultType="int" parameterType="String">
		SELECT COUNT(*) FROM pucoMember
		<include refid="midcheck" />
	</select>
	<select id="memberGetpwd" resultType="Member" parameterType="String">
		SELECT mid,mpwd,memail,mno,mimageurl FROM pucoMember
		<include refid="midcheck" />

	</select>

	<!-- Userpage 데이터 -->
	<select id="getUserData" resultType="Member" parameterType="int">
		SELECT mno,mid,memail,mimageurl,filesize,mdate,mpoint,lno,logindate,mtags
		FROM
		pucoMember
		WHERE mno=#{mno}
	</select>
	<!-- 수강정보 -->
	<select id="getUserCourse" resultType="String" parameterType="int">
		select gname FROM CourseGroup cg
		LEFT join infoattendant ia
		On
		cg.gno=ia.gno
		WHERE ia.mno=#{mno}
	</select>
	<!-- 로그인시 -->
	<update id="loginUpdate" parameterType="int">
		UPDATE pucomember SET
		logindate = SYSDATE,mpoint=mpoint+5
		WHERE mno=#{mno}
	</update>
	<!-- 득점 -->
	<update id="getPoint" parameterType="int">
		UPDATE pucomember SET
		mpoint
		= mpoint+#{point}
		WHERE mno=#{mno}
	</update>

	<update id="userUpdate" parameterType="Member">
		<!-- UPDATE pucomember SET MimageURL=#{mimageURL},filesize=#{filesize}, 
			mtags=#{tags} WHERE no=#{mno} -->
		UPDATE pucomember SET
		MimageURL=#{mimageURL},filesize=#{filesize}
		WHERE
		mno=#{mno}


	</update>
	<select id="getTagName" resultType="String" parameterType="int">
		SELECT tgname
		FROM tag
		WHERE tgno=#{tgno}
	</select>


	<select id="getTagList" resultType="String" parameterType="int">
		SELECT mtags
		FROM pucomember
		WHERE mno=#{mno}
	</select>
	
<!-- 쓴 글 & 답변단 글 가져오기 -->
		<select id ="getUserPost" resultType="QBoard" parameterType="int">
	SELECT bsubject,bno
	 FROM  mainboard MT
	 WHERE mno=#{mno}
	 Order by bhit DESC
	</select>
	
	<!-- 쓴 글 & 답변단 글 가져오기 -->
		<select id ="getUserAnswerPost" resultType="QBoard" parameterType="int">
	SELECT AT.bno, MT.bsubject as bsubject
	 FROM  answer AT
	 LEFT JOIN mainboard MT
	 on AT.bno=MT.bno
	 WHERE AT.mno=#{mno}
	 Order by rhit DESC
	</select>
	
	<!-- 통계  -->
	<!-- 
	CREATE TABLE pucoMember(
   Mno NUMBER CONSTRAINT pcm_mno_nn NOT NULL,
   Mid VARCHAR2(20) CONSTRAINT pcm_id_nn NOT NULL,
   Mpwd VARCHAR2(20) CONSTRAINT pcm_pwd_nn NOT NULL,
   Memail    VARCHAR2(320) CONSTRAINT pcm_em_nn NOT NULL,
   MimageURL VARCHAR2(400),   
   Mdate DATE DEFAULT SYSDATE,
   Mpoint NUMBER DEFAULT 0,
   Lno NUMBER DEFAULT 1,
   CONSTRAINT pcm_mno_pk PRIMARY KEY(Mno),
   CONSTRAINT pcm_lno_fk FOREIGN KEY(Lno)
   REFERENCES memLevel(Lno)
);
	
	 -->
	<!-- 회원가입 -->
	<insert id="insertMember" parameterType="Member">
		INSERT INTO pucoMember(Mno,Mid,Mpwd,Memail)
		VALUES((SELECT NVL(MAX(Mno)+1,1) FROM pucoMember),
		#{mid},#{mpwd},#{memail})
	</insert>
</mapper>